name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build application
        run: npm run build
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Calculate SHA512
        id: hash
        shell: powershell
        run: |
          $hash = (Get-FileHash -Path "dist\poe1-kakao-launcher-*.exe" -Algorithm SHA512).Hash
          echo "sha512=$hash" >> $env:GITHUB_OUTPUT
      
      - name: Upload Release Asset
        uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: |
            dist/*.exe
            dist/*.yml
          body: |
            ## ğŸ‰ POE1 Kakao Launcher Release
            
            ### ğŸ“¦ ë‹¤ìš´ë¡œë“œ
            ì•„ë˜ `poe1-kakao-launcher-setup.exe` íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.
            
            ### ğŸ”’ SHA512 ì²´í¬ì„¬
            ```
            ${{ steps.hash.outputs.sha512 }}
            ```
            
            ### ğŸ“‹ ì„¤ì¹˜ ë°©ë²•
            ìì„¸í•œ ì„¤ì¹˜ ë°©ë²•ì€ [README.md](https://github.com/${{ github.repository }}/blob/main/README.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
            
            ### âœ¨ ì£¼ìš” ê¸°ëŠ¥
            - ë‹¤ìŒê²Œì„ìŠ¤íƒ€í„° ìš°íšŒ
            - ìë™ ê²Œì„ ì‹¤í–‰
            - ìŠ¤íŒ€ë± ìµœì í™”
            
            ### âš™ï¸ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­
            - ìŠ¤íŒ€ë± (SteamOS 3.x)
            - Proton 9.0 ì´ìƒ
            - ì•½ 150MB ì—¬ìœ  ê³µê°„
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        with:
          name: poe1-kakao-launcher
          path: dist/*.exe
